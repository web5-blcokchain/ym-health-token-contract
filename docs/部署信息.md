# HealthToken 项目部署信息

## 📋 合约地址 (BSC 测试网)

### 已部署合约

| 合约名称 | 地址 | BSCScan 链接 |
|---------|------|-------------|
| MockUSDT | `0xeb4C53574edBF035FfBAF647b3E957b4FB88CD6B` | [查看合约](https://testnet.bscscan.com/address/0xeb4C53574edBF035FfBAF647b3E957b4FB88CD6B) |
| HLTToken | `0x74f1ED24295F42682EEB4F4A36d264cdA40DB66e` | [查看合约](https://testnet.bscscan.com/address/0x74f1ED24295F42682EEB4F4A36d264cdA40DB66e) |
| Crowdsale | `0x42bD80016995Af0Ae1fDb18944e2817b184f485b` | [查看合约](https://testnet.bscscan.com/address/0x42bD80016995Af0Ae1fDb18944e2817b184f485b) |
| MockUSDT | `0xB9345Bfe74aC71D2C1bE0212F5bff3F67cB85ba4` | [查看合约](https://testnet.bscscan.com/address/0xB9345Bfe74aC71D2C1bE0212F5bff3F67cB85ba4) |
| Crowdsale | `0x32135980bB2468DbF4e53786148eA0C000F8Fdef` | [查看合约](https://testnet.bscscan.com/address/0x32135980bB2468DbF4e53786148eA0C000F8Fdef) |

### 合约配置信息

- 网络: BSC 测试网 (Chain ID: 97)
- USDT（支付代币）地址: `0xeb4C53574edBF035FfBAF647b3E957b4FB88CD6B`（测试环境固定使用该 MockUSDT 地址）
- 代币兑换比例: 1 USDT = 12 HLT
- MockUSDT 总供应量: 1,000,000 USDT（可按需 mint）
- HLT 总供应量: 100,000,000 HLT
- 众筹合约代币余额: 23,999,999.9999999988 HLT
- 锁仓时长: 测试环境 1 小时（3600 秒），正式环境 365 天（31536000 秒）

## 🚀 常用脚本命令

### 部署相关

```bash
# 部署 MockUSDT (BSC 测试网已存在固定地址，一般无需重复执行)
npx hardhat run scripts/deploy-mockusdt-bsc-testnet.js --network bscTestnet

# 部署主合约 (HLTToken + Crowdsale)
# 测试环境：无需设置 USDT_ADDRESS，会自动使用固定 MockUSDT；锁仓默认 1 小时
npx hardhat run scripts/deploy-bsc-testnet-simple.js --network bscTestnet

# 正式环境：必须显式设置 USDT_ADDRESS，锁仓建议 365 天
USDT_ADDRESS=<mainnet_usdt_address> CROWDSALE_LOCK_DURATION=31536000 \
  npx hardhat run scripts/deploy-bsc-testnet-simple.js --network bscMainnet
```

### 测试相关

```bash
# 运行 BSC 测试网集成测试
npx hardhat run scripts/integration-test-bsc.js --network bscTestnet

# 运行单元测试
npx hardhat test
```

### 合约验证

```bash
# 验证 HLTToken 合约（按部署输出中的命令为准）
npx hardhat verify --network bscTestnet 0x74f1ED24295F42682EEB4F4A36d264cdA40DB66e "HealthLife Token" "HLT" 0x68eb4FA243bB04909e3Aa4F1e5186556ccd122a2 0xaeec208c1fdE4636570E2C6E72A256c53c774fac

# 验证 Crowdsale 合约（按部署输出中的命令为准）
npx hardhat verify --network bscTestnet 0x42bD80016995Af0Ae1fDb18944e2817b184f485b 0x74f1ED24295F42682EEB4F4A36d264cdA40DB66e 0xeb4C53574edBF035FfBAF647b3E957b4FB88CD6B 0x68eb4FA243bB04909e3Aa4F1e5186556ccd122a2 3600
```

## 📝 环境配置

```bash
# 私钥配置
PRIVATE_KEY=your_private_key_here

# BSC 网络配置
BSC_TESTNET_URL=https://data-seed-prebsc-1-s1.binance.org:8545/

# BSCScan API 密钥 (用于合约验证)
BSCSCAN_API_KEY=your_bscscan_api_key_here

# 部署参数（可选）
# 测试环境无需设置 USDT_ADDRESS，会自动使用固定 MockUSDT 地址
# 主网请显式设置 USDT_ADDRESS 并将锁仓时间设置为 365 天
USDT_ADDRESS=
CROWDSALE_LOCK_DURATION=3600
SALE_FUND_AMOUNT=1000000
OWNER_ADDRESS=0x...
OTHER_ACCOUNT_ADDRESS=0x...
+ OTHER_ACCOUNT_ADDRESS=0xaeec208c1fdE4636570E2C6E72A256c53c774fac
```

## ℹ️ 说明

- 测试网固定使用 MockUSDT 地址，避免多地址混淆
- 正式网需使用真实 USDT 地址，并将锁仓时长设置为 365 天
- 合约内部使用代币层锁仓设计，无需单独的 Vault 合约，转账会自动校验锁仓额度
- 购买次数上限（策略约束）：单地址最多购买 10 次（合约未强约束，作为业务与前端约束）

## 🔧 运维操作（众筹）
### 启动众筹
```bash
CROWDSALE_ADDRESS=<deployed_crowdsale> \
npx hardhat run scripts/start-crowdsale.js --network bscTestnet
```

### 回收未售出的 HLT（众筹结束后）
```bash
node -e "require('dotenv').config();(async()=>{const {ethers}=require('hardhat');const [o]=await ethers.getSigners();const C=await ethers.getContractFactory('Crowdsale');const c=C.attach(process.env.CROWDSALE_ADDRESS);const tx=await c.withdrawUnsoldHLT();console.log('tx',tx.hash);await tx.wait();console.log('done');})().catch(e=>{console.error(e);process.exit(1);});" 
```
- 环境变量：CROWDSALE_ADDRESS=<deployed_crowdsale>

---

## 🆕 最新部署记录（BSC 测试网）

- 时间：见 Hardhat 日志（上述命令刚刚执行）
- 网络：BSC Testnet (ChainId: 97)
- 锁仓时长：3600 秒（测试默认 1 小时）
- 关键地址：
  - HLTToken: `0x74f1ED24295F42682EEB4F4A36d264cdA40DB66e`
  - Crowdsale: `0x42bD80016995Af0Ae1fDb18944e2817b184f485b`
  - USDT: `0xeb4C53574edBF035FfBAF647b3E957b4FB88CD6B`
  - OTHER_ACCOUNT: `0xaeec208c1fdE4636570E2C6E72A256c53c774fac`
- 关键交易：
  - 开始众筹 Tx: `0x2983e28a1368a590ed7ec155729fa72bca158771346ad8ef93233e70d2a03c82`
  - 真实购买（100 USDT → 1200 HLT）Tx: `0xc23369593bcf8b9c3399b55b27a104af3cd531b5d8b86a07296493c8f8354b2e`
  - USDT 增发（测试准备）Tx: `0x995700174479daf1f752aa94e37732eeba5021dcd3f8c5e2004a520e40d8ae62`

### 验证命令参考

```bash
npx hardhat verify --network bscTestnet 0xF7a84a11EB4FbA0c77Ac1779a11c48F1D18Bf35D "HealthLife Token" "HLT" 0x68eb4FA243bB04909e3Aa4F1e5186556ccd122a2 0xaeec208c1fdE4636570E2C6E72A256c53c774fac
npx hardhat verify --network bscTestnet 0xf8E6E83A5771470D95b7E12F733f1f35DfFc5047 0xF7a84a11EB4FbA0c77Ac1779a11c48F1D18Bf35D 0xeb4C53574edBF035FfBAF647b3E957b4FB88CD6B 0x68eb4FA243bB04909e3Aa4F1e5186556ccd122a2 3600
```

### 测试相关

```bash
# 运行 BSC 测试网集成测试
npx hardhat run scripts/integration-test-bsc.js --network bscTestnet

# 运行单元测试
npx hardhat test

# 运行特定测试文件
npx hardhat test test/HLTToken.test.js
npx hardhat test test/Crowdsale.test.js
```

### MockUSDT 管理

#### 🪙 铸造 MockUSDT 代币

**方式一：简化版本 (推荐)**
```bash
# 直接运行，使用脚本内置地址和数量
npx hardhat run scripts/mint-mockusdt-simple.js --network bscTestnet
```

**方式二：环境变量配置**
```bash
# 设置环境变量后运行
MOCKUSDT_ADDRESS=0xeb4C53574edBF035FfBAF647b3E957b4FB88CD6B \
RECIPIENT_ADDRESS=0xcc76a9BeEf0dF6F0ccD29515588c245F98744351 \
MINT_AMOUNT=10000000 \
npx hardhat run scripts/mint-mockusdt.js --network bscTestnet
```

**方式三：批量铸造**
```bash
# 批量给多个地址铸造代币
npx hardhat run scripts/mint-mockusdt.js --network bscTestnet --batch
```

#### 📋 Mint 参数说明

- **MOCKUSDT_ADDRESS**: MockUSDT 合约地址 (`0xeb4C53574edBF035FfBAF647b3E957b4FB88CD6B`)
- **RECIPIENT_ADDRESS**: 接收代币的地址
- **MINT_AMOUNT**: 铸造数量 (单位: USDT，支持小数)

#### 🌐 多网络支持

```bash
# BSC 测试网 (当前部署)
npx hardhat run scripts/mint-mockusdt-simple.js --network bscTestnet

# BSC 主网 (需要重新部署 MockUSDT)
npx hardhat run scripts/mint-mockusdt-simple.js --network bscMainnet

# 以太坊 Sepolia 测试网 (需要重新部署 MockUSDT)
npx hardhat run scripts/mint-mockusdt-simple.js --network sepolia

# 以太坊 Goerli 测试网 (需要重新部署 MockUSDT)
npx hardhat run scripts/mint-mockusdt-simple.js --network goerli
```

#### ⚠️ 注意事项

1. **权限要求**: 只有 MockUSDT 合约的 owner 才能执行 mint 操作
2. **网络切换**: 切换网络时需要确保该网络上已部署 MockUSDT 合约
3. **Gas 费用**: 确保账户有足够的原生代币支付 Gas 费用
4. **地址格式**: 所有地址必须是有效的以太坊地址格式

### 合约验证

```bash
# 验证 HLTToken 合约
npx hardhat verify --network bscTestnet 0xB9345Bfe74aC71D2C1bE0212F5bff3F67cB85ba4 "HealthLife Token" "HLT" 0x68eb4FA243bB04909e3Aa4F1e5186556ccd122a2 0x620bdC24abCf45F8Ea1D99fEF2EC5Aae7CD300A7

# 验证 Crowdsale 合约
npx hardhat verify --network bscTestnet 0x32135980bB2468DbF4e53786148eA0C000F8Fdef 0xB9345Bfe74aC71D2C1bE0212F5bff3F67cB85ba4 0xeb4C53574edBF035FfBAF647b3E957b4FB88CD6B 12

# 验证 MockUSDT 合约
npx hardhat verify --network bscTestnet 0xeb4C53574edBF035FfBAF647b3E957b4FB88CD6B
```

### 网络配置

```bash
# 检查网络连接
npx hardhat run --network bscTestnet scripts/integration-test-bsc.js

# 查看账户余额
npx hardhat console --network bscTestnet
```

## 📝 环境配置

### 必需的环境变量 (.env)

```bash
# 私钥配置
PRIVATE_KEY=your_private_key_here

# BSC 网络配置
BSC_TESTNET_URL=https://data-seed-prebsc-1-s1.binance.org:8545/

# BSCScan API 密钥 (用于合约验证)
BSCSCAN_API_KEY=your_bscscan_api_key_here

# 部署参数（可选）
# 测试环境无需设置 USDT_ADDRESS，会自动使用固定 MockUSDT 地址
# 主网请显式设置 USDT_ADDRESS 并将锁仓时间设置为 365 天
USDT_ADDRESS=
CROWDSALE_LOCK_DURATION=3600
SALE_FUND_AMOUNT=1000000
OWNER_ADDRESS=0x...
OTHER_ACCOUNT_ADDRESS=0x...
+ OTHER_ACCOUNT_ADDRESS=0xaeec208c1fdE4636570E2C6E72A256c53c774fac
```

## ℹ️ 说明

- 测试网固定使用 MockUSDT 地址，避免多地址混淆
- 正式网需使用真实 USDT 地址，并将锁仓时长设置为 365 天
- 合约内部使用代币层锁仓设计，无需单独的 Vault 合约，转账会自动校验锁仓额度
- 购买次数上限（策略约束）：单地址最多购买 10 次（合约未强约束，作为业务与前端约束）

## 🔧 运维操作（众筹）
### 启动众筹
```bash
CROWDSALE_ADDRESS=<deployed_crowdsale> \
npx hardhat run scripts/start-crowdsale.js --network bscTestnet
```

### 回收未售出的 HLT（众筹结束后）
```bash
node -e "require('dotenv').config();(async()=>{const {ethers}=require('hardhat');const [o]=await ethers.getSigners();const C=await ethers.getContractFactory('Crowdsale');const c=C.attach(process.env.CROWDSALE_ADDRESS);const tx=await c.withdrawUnsoldHLT();console.log('tx',tx.hash);await tx.wait();console.log('done');})().catch(e=>{console.error(e);process.exit(1);});" 
```
- 环境变量：CROWDSALE_ADDRESS=<deployed_crowdsale>